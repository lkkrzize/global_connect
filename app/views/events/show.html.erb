<div class="mt-4 mx-5">
  <div class="d-flex justify-content-between">

    <div class="description w-75">
      <br>

      <div class="banner bg-light" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url( '<%= event_banner_image(@event) %>' );">
        <div class="container mt-3">
          <div class="d-flex flex-row justify-content-between align-items-top mb-3">
            <h1><%= @event.name %></h1>
            <% if @event.user == current_user %>
              <%= link_to "Edit Event", edit_event_path(@event), class: "btn btn-warning" %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="p-3 rounded mt-3 mx-4 bg-light">
        <br>
        <p><strong>Description:</strong> <%= @event.description %></p>
        <p><strong>Date:</strong> <%= @event.date %> <strong>Starts At:</strong> <%= @event.starts_at %> <strong>Ends At:</strong> <%= @event.ends_at %></p>
        <p><strong>Location:</strong> <%= @event.location %><strong> People Limit:</strong> <%= @event.people_limit %></p>
      </div>

      <div class="reviews p-3 rounded mt-3 mx-4 mb-5 bg-light">
        <div class="d-flex justify-content-between align-items-center">
          <h2>Reviews</h2>
            <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#reviewModal">
              Add a review
            </button>
        </div>
        <ul>
          <% @event.reviews.each do |review| %>
            <li>
              <strong>Rating:</strong> <%= 'â­' * review.rating %> |
              <strong>Reviewer:</strong> <%= review.user.email %> |
              <strong>Comment:</strong> <%= review.comment %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>

    <div class="attendees container w-25 p-3 mx-4 mb-5 text-center bg-light ms-auto">
      <h2>People Attending</h2>
      <ul class="list-unstyled">
        <% @event.event_users.each do |event_user| %>
          <li><%= event_user.user.email %></li>
        <% end %>
      </ul>

      <% if @event.event_users.exists?(user: current_user) %>
        <%= form_with url: event_event_user_path(@event, current_user.event_users.find_by(event: @event)), method: :delete do %>
          <button type="submit" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#exampleModal2">
            Unregister
          </button>
        <% end %>
      <% elsif @event.user == current_user %>
        <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#selfRegisterModal">
          Register
        </button>
      <% else %>
        <%= form_with url: event_event_users_path(@event), method: :post do %>
          <button type="submit" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Register
          </button>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-0 text-center">
        <h1 class="modal-title fs-4 w-100" id="exampleModalLabel">Registration for <%= "#{@event.name}" %> Complete!</h1>
      </div>
      <div class="modal-body text-center">
        <p>You're all set for the event ðŸŽ‰</p>
      </div>
      <div class="modal-footer border-0 d-flex justify-content-center">
        <%= link_to "EVENT CHAT", chat_path(@event), class: "btn btn-dark" %>
        <%= link_to "Close", event_path(@event), class: "btn btn-dark" %>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel2" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-0 text-center">
        <h1 class="modal-title fs-4 w-100" id="exampleModalLabel2">Removed from <%= "#{@event.name}" %></h1>
      </div>
      <div class="modal-body text-center">
        <p>You have successfully unregistered from the event.</p>
      </div>
      <div class="modal-footer border-0 d-flex justify-content-center">
        <%= link_to "OK", event_path(@event), class: "btn btn-dark" %>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="selfRegisterModal" tabindex="-1" aria-labelledby="selfRegisterLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-0 text-center">
        <h1 class="modal-title fs-4 w-100" id="selfRegisterLabel">Registration Not Allowed</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p>You cannot register for your own event.</p>
      </div>
      <div class="modal-footer border-0 d-flex justify-content-center">
        <button type="button" class="btn btn-dark" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-0 text-center">
        <h1 class="modal-title fs-4 w-100" id="reviewModalLabel">Add a Review for <%= @event.name %></h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= simple_form_for([@event, @review]) do |f| %>
          <div class="mb-3">
            <%= f.input :rating, as: :integer, input_html: { min: 1, max: 5 }, label: "Rating (1-5)" %>
          </div>
          <div class="mb-3">
            <%= f.input :comment, as: :text, label: "Comment" %>
          </div>
          <div class="modal-footer">
            <%= f.button :submit, "Submit Review", class: "btn btn-dark" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
